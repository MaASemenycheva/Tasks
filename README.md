# Fastapi+swagger+docker
Python backend на FastAPI с базой данных Postgres + Swagger UI 


## Запуск

Экспорт необходимых переменных среды из файла postgres.env
```bash
source set_env.sh
```

Команда ниже создает локальный каталог с именем `postgres_data` в папке postgres, который связан с томом докера postgres для сохранения данных:
```bash
mkdir postgres/postgres_data
```

Серверная часть fastapi и службы postgres запускаются с помощью следующей команды:
```bash
docker compose up -d
```

Серверную часть fastapi и службы postgres можно остановить с помощью следующей команды:
```bash
docker compose down
```

## Детали конфигурации
Контейнер службы Postgres размещен на порту «5432», а серверная служба fastapi — на порту «8000». Во время тестирования службы убедитесь, что эти два порта свободны.

## Тестирование локального клиента

Нажмите [здесь](http://127.0.0.1:8000/docs#), чтобы открыть UI Swagger, созданный для локального тестирования endpoint-ов службы fastapi. Список endpoint-ов, доступных в API, приведен ниже:



|Endpoint | Цель                                                                          |
| ------- |-------------------------------------------------------------------------------|
|/        | Endpoint для перехода на домашнюю страницу                                    |
|/health  | Endpoint, чтобы проверить состояние бэкэнда и службы Postgres                 |
|/fetch   | Endpoint для получения статей без комментариев из таблицы Postgres            |
|/nrows   | Endpoint для получения количества статей без комментариев из таблицы Postgres |

## Проверка журналов
Замените <CONTAINER_NAME> в приведенной ниже команде именем или тегом контейнера службы FastAPI, чтобы проверить `последние 10 журналов`:


```bash
docker logs -f --tail 10 <CONTAINER_NAME>
```

## Скрины

Возвращает основную информацию о сервисе:

<image src="./img/2023-09-24_17-34-36.png" alt="Возвращает основную информацию о сервисе"/>

dict: словарь со статусами бэкенда и Postgres. Если резервная копия находится в автономном режиме, мы получим внутреннюю ошибку сервера.

<image src="./img/2023-09-24_17-35-12.png" alt="Словарь со статусами бэкенда и Postgres"/>

Endpoint, ответственный за получение статей без комментариев из таблицы:
<image src="./img/2023-09-24_17-35-29.png" alt="Endpoint, ответственный за получение статей без комментариев из таблицы"/>

Endpoint, ответственный за получение количества статей без комментариев из таблицы:

<image src="./img/2023-09-24_17-35-45.png" alt="Endpoint, ответственный за получение количества статей без комментариев из таблицы"/>

Логи:

<image src="./img/2023-09-24_17-37-41.png" alt="Логи"/>

Содержимое  того, что содержится в контейнеризированной базе:

<image src="./img/2023-09-24_17-59-00.png" alt="Содержимое  того, что содержится в контейнеризированной базе"/>

Статьи без комментариев:

<image src="./img/2023-09-24_18-01-00.png" alt="Статьи без комментариев"/>

Docker-контейнеры:

<image src="./img/2023-09-24_18-06-00.png" alt="Docker-контейнеры"/>







